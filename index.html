<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Lava Glitch: 100m Star Edition</title>
    <style>
        :root { --ui-primary: #00ffcc; --ui-accent: #ff00ff; }
        body {
            margin: 0;
            padding: 0;
            background-color: #111;
            font-family: 'Courier New', Courier, monospace;
            overflow-y: auto; /* Allows scrolling to the backstory */
            color: white;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            max-width: 500px;
            margin: 0 auto;
            background: #1a1a1a;
            overflow: hidden;
        }
        canvas { display: block; image-rendering: pixelated; }
        #ui { position: absolute; top: 20px; width: 100%; text-align: center; z-index: 10; pointer-events: none; }
        #score { font-size: 40px; font-weight: bold; color: var(--ui-primary); text-shadow: 2px 2px 0 #000; }
        
        #menu-layer {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .btn {
            background: #fff; color: #000; border: none; padding: 15px 30px;
            font-size: 20px; font-weight: bold; cursor: pointer; border-radius: 8px; margin: 10px; width: 220px;
        }

        /* BACKSTORY SECTION - IMPORTANT FOR ADSENSE */
        #backstory-section {
            position: relative;
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
            background: #222;
            border: 2px solid var(--ui-primary);
            font-family: sans-serif;
            color: #eee;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui"><div id="score">0m</div></div>
    
    <div id="menu-layer">
        <h1 id="menu-title" style="color: var(--ui-primary);">LAVA GLITCH</h1>
        <button id="action-btn" class="btn">START GAME</button>
    </div>

    <canvas id="canvas"></canvas>
</div>

<section id="backstory-section">
    <h2 style="color: var(--ui-primary);">Lava Glitch Survival Guide</h2>
    <p>The system is crashing. In 2026, the digital world is melting into lava. As the <strong>Lava Glitch</strong>, you must jump to survive. Collect gravity stars every 100 meters to maintain your code stability!</p>
    <p><strong>Controls:</strong> Tap the left or right side of the screen to move. Watch the lavaâ€”it rises faster the higher you go.</p>
    <hr style="border-color: #444;">
    <p><a href="privacy.html" style="color: var(--ui-primary);">Privacy Policy</a></p>
</section>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const menuLayer = document.getElementById('menu-layer');
    const actionBtn = document.getElementById('action-btn');
    const menuTitle = document.getElementById('menu-title');

    let width, height, player, platforms = [], stars = [], lavaY, score = 0, cameraY = 0;
    let gameActive = false;
    let lastStarMilestone = 0; // The 100m trigger

    class Player {
        constructor() {
            this.x = 200; this.y = 500;
            this.vx = 0; this.vy = 0;
            this.width = 24; this.height = 24;
        }
        update() {
            this.vy += 0.5; // Gravity
            this.x += this.vx;
            this.y += this.vy;
            if (this.x < 0) this.x = width;
            if (this.x > width) this.x = 0;

            platforms.forEach(p => {
                if (this.vy > 0 && this.x + 20 > p.x && this.x < p.x + p.w && this.y + 24 > p.y && this.y + 24 < p.y + 15) {
                    this.y = p.y - 24;
                    this.vy = -13; // Jump
                }
            });

            stars.forEach((s, index) => {
                if (!s.collected && Math.hypot(this.x - s.x, this.y - s.y) < 30) {
                    s.collected = true;
                    score += 150; // Bonus for star
                }
            });

            if (this.y > lavaY) endGame();
        }
        draw() {
            ctx.fillStyle = '#00ffcc';
            ctx.fillRect(this.x, this.y - cameraY, 24, 24);
        }
    }

    class Star {
        constructor(y) {
            this.x = Math.random() * (width - 60) + 30;
            this.y = y;
            this.collected = false;
        }
        draw() {
            if (this.collected) return;
            ctx.fillStyle = '#ffd700';
            ctx.beginPath();
            ctx.arc(this.x, this.y - cameraY, 12, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 15; ctx.shadowColor = "gold";
        }
    }

    function spawnPlatform(y) {
        platforms.push({ x: Math.random() * (width - 80), y: y, w: 80, h: 15 });
    }

    function init() {
        width = canvas.width = Math.min(window.innerWidth, 500);
        height = canvas.height = window.innerHeight;
        player = new Player();
        platforms = []; stars = [];
        score = 0; lastStarMilestone = 0;
        cameraY = 0; lavaY = height + 100;
        gameActive = true;
        menuLayer.style.display = 'none';

        for (let i = 0; i < 15; i++) spawnPlatform(height - i * 140);
    }

    function endGame() {
        gameActive = false;
        menuTitle.innerText = "GAME OVER";
        actionBtn.innerText = "TRY AGAIN";
        menuLayer.style.display = 'flex';
    }

    // Input Handling
    window.addEventListener('touchstart', (e) => {
        if (!gameActive) return;
        if (e.touches[0].clientX < width / 2) player.vx = -5;
        else player.vx = 5;
    });
    window.addEventListener('touchend', () => player.vx = 0);

    function update() {
        if (!gameActive) return;
        player.update();
        
        // Dynamic Score based on height
        let currentHeight = Math.floor(Math.abs(player.y - 500) / 10);
        if (currentHeight > score) score = currentHeight;
        scoreEl.innerText = score + "m";

        // THE 100M STAR LOGIC
        if (score >= lastStarMilestone + 100) {
            lastStarMilestone += 100; 
            // Spawn star way ahead of the player
            stars.push(new Star(player.y - 400));
        }

        if (player.y < cameraY + 250) cameraY = player.y - 250;
        lavaY -= (1 + (score / 500)); // Lava gets faster

        if (platforms[platforms.length - 1].y > cameraY - 100) {
            spawnPlatform(platforms[platforms.length - 1].y - 140);
        }
    }

    function draw() {
        ctx.clearRect(0, 0, width, height);
        ctx.fillStyle = '#1a1a1a';
        ctx.fillRect(0, 0, width, height);

        platforms.forEach(p => {
            ctx.fillStyle = '#444';
            ctx.fillRect(p.x, p.y - cameraY, p.w, p.h);
        });

        stars.forEach(s => s.draw());
        ctx.shadowBlur = 0; // Reset glow for other items

        ctx.fillStyle = 'rgba(255, 77, 0, 0.7)';
        ctx.fillRect(0, lavaY - cameraY, width, height);

        player.draw();
    }

    function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }

    actionBtn.onclick = init;
    gameLoop();
</script>

</body>
</html>
